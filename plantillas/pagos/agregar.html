{% extends 'base.html' %}


{% block titulo%} Agregar {% endblock %}

{% block contenido %}
<br>
<br>
<div class="col-sm-3">

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Identificar Usuario</h3>
  </div>
  <div class="panel-body">
              <label for="buscar">Escribe el numero contrato</label>
              <input disable="" id="id_contrato" type="text" class="form-control" >
              <label for="digito">Escribe el digito verificador</label>
              <input id="id_digito" type="text" class="form-control" >
              <br>
              <button id="btn_zona" type="button" class="btn btn-primary">Buscar Usuarios</button>
              
  </div>
</div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Ingresar conceptos</h3>
  </div>
  <div class="panel-body">
  {{form_conceptos}}<br><br>
    <button id="btn_concepto" class="btn btn-primary">Agregar un concepto</button>
    <br><br>
  </div>
</div>


<!-- -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Ingrese los datos</h3>
  </div>
  <div class="panel-body">
	<form method = "POST">
		{%csrf_token%}
    
    <!--<label for="id_cliente">ID:</label>
    <input id="id_cliente" type="text" class="form-control" disabled>
    <label for="id_nombre">Nombre:</label>
    <input id="id_nombre" type="text" class="form-control" disabled>
		<label for="id_direccion">Direccion:</label>
    <input id="id_calle" type="text" class="form-control" disabled>-->
    {{form.as_p}}
		<input  class="btn btn-primary" type = "submit" value = "Guardar">
	</form>     
  </div>
</div>


</div>
<div class="col-sm-9">
<script type="application/processing" id="pro">
        PImage img;  // Declare variable "a" of type PImage

void setup() {
  size(840, 670);
  // The image file must be in the data folder of the current sketch 
  // to load successfully
  img = loadImage("/static/img/recibo.jpg");  // Load the image into the program  
  
}

void draw() {
  // Displays the image at its actual size at point (0,0)
  image(img, 0, 0);
  textSize(12);

  fill(0, 0, 0);
  text(nombre, 80, 140);   //extrae de cliente
  fill(0, 0, 0);
  text(direccion, 90, 158); // extrae de cliente
  fill(0, 0, 0);
  text(municipio, 95, 175);  // extrae de dato del cliente Municipio
  fill(0, 0, 0);
  text(rfc, 60, 190);  // extrae de cliente
  fill(0, 0, 0);
  text(telefono, 270, 191);   // extrae de cliente

  fill(0, 0, 0);
  text(sector, 460, 158);  //extrae de sector en cliente
  fill(0, 0, 0);
  text(ruta, 490, 158);  //se extrae ruta de cliente
  fill(0, 0, 0);
  text(folio, 560, 158); //ingresa folio
  fill(0, 0, 0);
  text(tservicio, 637, 158); // se extrae de tipo servicio
  fill(0, 0, 0);
  text(tusuario, 657, 158); // tipo usuario
  fill(0, 0, 0);
  text(contrato, 710, 158);  // se extrae de contrato en cliente
  fill(0, 0, 0);
  text(dv, 785, 158);   // digito verfificador de cliente
  fill(0, 0, 0);
  text(observaciones, 450, 210);    // ingresa observaciones 


  fill(0, 0, 0);
  text(norecibo, 40, 227);   // extrae de cliente norecibo
  fill(0, 0, 0);
  text(lanterior, 140, 227);   // ingresa dato lectura anterior
  fill(0, 0, 0);
  text(lactual, 240, 227);  // ingresa dato lectura actual
  fill(0, 0, 0);
  text(consumo, 340, 227);  // diferencia entre lectura actual menos el anterior = consumo m3

  //------------recibo emitido----------------
  fill(0, 0, 0);
  text(reciboemitido_regst[0], 200, 380);  //catalogo de concepto1
  fill(0, 0, 0);
  text(reciboemitido_regst[4], 200, 400);  //catalogo de concepto2 
  fill(0, 0, 0);
  text(reciboemitido_regst[8], 200, 420);  //catalogo de concepto3
  fill(0, 0, 0);
  text(reciboemitido_regst[12], 200, 437);  //catalogo de concepto4  
  fill(0, 0, 0);
  text(reciboemitido_regst[16], 200, 455);  //catalogo de concepto5
  fill(0, 0, 0);
  text(reciboemitido_regst[20], 200, 473);  //catalogo de concepto6  
  fill(0, 0, 0);
  text(reciboemitido_regst[24], 200, 490);  //catalogo de concepto7
  fill(0, 0, 0);
  text(reciboemitido_regst[28], 200, 507);  //catalogo de concepto8
  
  //------------importe recibo emitido---------
  fill(0, 0, 0);
  text(reciboemitido_regst[1], 260, 380);  //importe1
  fill(0, 0, 0);
  text(reciboemitido_regst[5], 260, 400);  //importe2
  fill(0, 0, 0);
  text(reciboemitido_regst[9], 260, 420);  //importe3
  fill(0, 0, 0);
  text(reciboemitido_regst[13], 260, 437);  //importe4
  fill(0, 0, 0);
  text(reciboemitido_regst[17], 260, 455);  //importe5
  fill(0, 0, 0);
  text(reciboemitido_regst[21], 260, 473);  //importe6
  fill(0, 0, 0);
  text(reciboemitido_regst[25], 260, 490);  //importe7
  fill(0, 0, 0);
  text(reciboemitido_regst[29], 260, 507);  //importe8

  //------------Modificacion----------------
  fill(0, 0, 0);
  text(reciboemitido_regst[2], 450, 380);  //ctipo movimiento1
  fill(0, 0, 0);
  text(reciboemitido_regst[6], 450, 400);  //ctipo movimiento2 
  fill(0, 0, 0);
  text(reciboemitido_regst[10], 450, 420);  //ctipo movimiento3
  fill(0, 0, 0);
  text(reciboemitido_regst[14], 450, 437); //ctipo movimiento4
  fill(0, 0, 0);
  text(reciboemitido_regst[18], 450, 455); //ctipo movimiento5 
  fill(0, 0, 0);
  text(reciboemitido_regst[22], 450, 473); //ctipo movimiento6
  fill(0, 0, 0);
  text(reciboemitido_regst[26], 450, 490); //ctipo movimiento7
  fill(0, 0, 0);
  text(reciboemitido_regst[30], 450, 510); //ctipo movimiento8 
 
      
  //------------importe modificacion---------
  fill(0, 0, 0);
  text(reciboemitido_regst[3], 510, 380);  //importemod1
  fill(0, 0, 0);
  text(reciboemitido_regst[7], 510, 400);  //importemod2
  fill(0, 0, 0);
  text(reciboemitido_regst[11], 510, 420);  //importemod3
  fill(0, 0, 0);
  text(reciboemitido_regst[15], 510, 437); //importemod4
  fill(0, 0, 0);
  text(reciboemitido_regst[19], 510, 455); //importemod5
  fill(0, 0, 0);
  text(reciboemitido_regst[23], 510, 473); //importemod6
  fill(0, 0, 0);
  text(reciboemitido_regst[27], 510, 490); //importemod7
  fill(0, 0, 0);
  text(reciboemitido_regst[31], 510, 510); //importemod8
 
  
  



  //------------pago a efectuar----------------
  fill(0, 0, 0);
  text(reciboemitido_regst[0], 650, 380);  //concepto1
  fill(0, 0, 0);
  text(reciboemitido_regst[4], 650, 400);  //concepto2 
  fill(0, 0, 0);
  text(reciboemitido_regst[8], 650, 420);  //concepto3
  fill(0, 0, 0);
  text(reciboemitido_regst[12], 650, 437);  //concepto4  
  fill(0, 0, 0);
  text(reciboemitido_regst[16], 650, 455);  //concepto5
  fill(0, 0, 0);
  text(reciboemitido_regst[20], 650, 473);  //concepto6  
  fill(0, 0, 0);
  text(reciboemitido_regst[24], 650, 490);  //concepto7
  fill(0, 0, 0);
  text(reciboemitido_regst[28], 650, 507);  //concepto8
  
  //------------importe pago efectuar---------
  fill(0, 0, 0);
  text(reciboemitido_regst[1], 710, 380);  //import1
  fill(0, 0, 0);
  text(reciboemitido_regst[5], 710, 400);  //importe2
  fill(0, 0, 0);
  text(reciboemitido_regst[9], 710, 420);  //importe3
  fill(0, 0, 0);
  text(reciboemitido_regst[13], 710, 437);  //importe4
  fill(0, 0, 0);
  text(reciboemitido_regst[17], 710, 455);  //importe5
  fill(0, 0, 0);
  text(reciboemitido_regst[21], 710, 473);  //importe6
  fill(0, 0, 0);
  text(reciboemitido_regst[25], 710, 490);  //importe7
  fill(0, 0, 0);
  text(reciboemitido_regst[29], 710, 507);  //importe8
  
  //resultado_total = parseFloat(reciboemitido_regst[1]) +  parseFloat(reciboemitido_regst[5]) + parseFloat(reciboemitido_regst[9]) + parseFloat(reciboemitido_regst[13]) + parseFloat(reciboemitido_regst[17]) + parseFloat(reciboemitido_regst[21]) +  parseFloat(reciboemitido_regst[25]) +  parseFloat(reciboemitido_regst[29]);


  fill(0, 0, 0);
  text(resultado_total, 710, 530); //Total a pagar

  fill(0, 0, 0);         
  text(totalletra, 460, 564);  //cantidad con letra 
   
  fill(0, 0, 0)
  text(mrezago, 125, 387);   //ingresa dato meses de razago
  fill(0, 0, 0)
  text(mfacturacion, 50, 430); //ingreso dato facturacion del mes

//----------------fecha de registro----------------
  fill(0, 0, 0);         
  text(dia, 40, 507); // dia
  fill(0, 0, 0);         
  text(mes, 90, 507); // mes
  fill(0, 0, 0);         
  text(anio, 140, 507); // a√±o
  
  fill(0, 0, 0);         
  text(elaboro, 260, 550); // elaboro
  fill(0, 0, 0);         
  text(puestoe, 260, 564); //puestoE
  
  fill(0, 0, 0);         
  text(autorizo, 260, 605); // autorizo
  fill(0, 0, 0);         
  text(puestoa, 260, 620);//puesto

  

  
  // Displays the image at point (0, height/2) at half of its size
  //image(img, 0, height/2, img.width/2, img.height/2);
}
</script>


<canvas width="200" height="200"></canvas></p>
<div style="height:0px;width:0px;overflow:hidden;"></div>

</div>



{% endblock %}

	{% block js%}

       <script type="text/javascript">
           
          $(document).ready(function(){

               
            $( "#btn_zona" ).click(function() {
              var txt_contrato=document.getElementById("id_contrato").value;
              var txt_digito=document.getElementById("id_digito").value;

                if (txt_contrato != "" && txt_digito != "") {
                  
                $.ajax({
                  type:"GET",
                  contentType:"application/json",
                  dateType:"json",
                  url:"/ws/cliente/contrato/"+txt_contrato+"/"+txt_digito,
                  success:function(response){
                  for(var i=0;i<response.length;i++){
                    //console.log(response[i].fields.Nombre);
                    $("#id_nombre").attr("value",response[0].fields.Nombre);
                    nombre = response[0].fields.Nombre;
                    $("#id_calle").attr("value",response[0].fields.Calle);
                    direccion = response[0].fields.Calle;
                    $("#id_cliente").attr("value",response[0].fields.pk);
                    sector = response[0].fields.sector;
                    contrato  = response[0].fields.Contrato;
                    iva = response[0].fields.iva;
                    digito = response[0].fields.Dig_verf;
                    //alert(response[0].fields.tipo_usuario+" "+response[0].fields.tipo_servicio);
                    tusuario = response[0].fields.tipo_usuario;
                    tservicio = response[0].fields.tipo_servicio;
                    ruta = response[0].fields.ruta;
                    dv = response[0].fields.Dig_verf;
                    rfc = response[0].fields.RFC;
                    municipio = response[0].fields.Municipio;
                    telefono = response[0].fields.Telefono;
                      /*
                            $.ajax({
                            type:"GET",
                            contentType:"application/json",
                            dateType:"json",
                            url:"/ws/tipo_usuario/"+response[0].fields.tipo_usuario,
                            success:function(response2){
                            for(var i=0;i<response2.length;i++){
                              tusuario = response2[0].fields.nombre;


                              }//for end
                              }//success

                            $.ajax({
                            type:"GET",
                            contentType:"application/json",
                            dateType:"json",
                            url:"/ws/tipo_servicio/"+response[0].fields.tipo_usuario,
                            success:function(response3){
                            for(var i=0;i<response3.length;i++){
                              tservicio = response3[0].fields.nombre;


                              }//for end
                              }//success

      */



                    }//for end
                    }//success





                  });


                }else{
                  alert("Ingrese un contrato y digito");
                }
               

                }); //click
                
            

              $( "#id_observaciones" ).keyup(function() {
                observaciones = $("#id_observaciones").val();
              });


              $( "#id_No_Recibo" ).keyup(function() {
                norecibo = $("#id_No_Recibo").val();
              });

              $( "#id_Lect_Anterior" ).keyup(function() {
                lanterior = $("#id_Lect_Anterior").val();
              });

              $( "#id_Lect_Actual" ).keyup(function(){
                lactual = $("#id_Lect_Actual").val();
                var cm3 =  parseInt($("#id_Lect_Actual").val()) - parseInt($("#id_Lect_Anterior").val());
                if (cm3 >= 0) {
                $("#id_Consumo_M3").val(cm3);


                }else{
                $("#id_Consumo_M3").val("0");                  
                }
                
                
              });


           
          });
           </script>



<script type="text/javascript">

$("#btn_concepto").click(function(){



if(contador_datos < 32){
          var cpg = $("#id_pago").val();
          var imp = $("#id_importe").val();
          var mod = $("#id_movimiento").val();
          var impt_mod = $("#id_importe_modificacion").val();

          resultado_total += parseFloat(imp);
          var num_campos = 0;

         reciboemitido_regst[contador_datos] = cpg;
         contador_datos += 1;
         reciboemitido_regst[contador_datos] = imp;
         contador_datos += 1;
         reciboemitido_regst[contador_datos] = mod;
         contador_datos += 1;
         reciboemitido_regst[contador_datos] = impt_mod;
         contador_datos += 1;
        if (cpg == "1" && iva == true) {
                var iva_consumo = (parseFloat(imp) /100)* 16;
               reciboemitido_regst[contador_datos] = "15";
               contador_datos += 1;
               reciboemitido_regst[contador_datos] = iva_consumo;
               contador_datos += 1;
               reciboemitido_regst[contador_datos] = " ";
               contador_datos += 1;
               reciboemitido_regst[contador_datos] = " ";
               contador_datos += 1;
                 

        }         

}else{
            alert("Ya hay espacio para mas registros");
}


});
</script>

  	{% endblock %}

